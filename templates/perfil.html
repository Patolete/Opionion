<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Opinion - Perfil</title>
   <link rel="stylesheet" type="text/css" href="../static/css/style.css">
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inknut+Antiqua:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
      .perfil-header {
         text-align: center;
         margin: 30px 0;
      }

      .perfil-header h2 {
         color: #8b6b9e;
         font-size: 2rem;
         margin-bottom: 10px;
      }

      .perfil-header p {
         color: #666;
         font-size: 1.1rem;
      }

      .nav-perfil {
         display: flex;
         justify-content: center;
         gap: 20px;
         margin: 30px 0;
         flex-wrap: wrap;
      }

      .btn-perfil {
         padding: 12px 25px;
         background: #8b6b9e;
         color: white;
         border: none;
         border-radius: 20px;
         font-size: 1rem;
         cursor: pointer;
         text-decoration: none;
         font-weight: 600;
         transition: all 0.3s;
         display: inline-block;
      }

      .btn-perfil:hover {
         background: #6b4b7e;
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(139, 107, 158, 0.3);
      }

      .movies-list {
         max-width: 800px;
         margin: 30px auto;
         padding: 0 20px;
      }

      .movie-item {
         background: #8b6b9e;
         border-radius: 15px;
         margin-bottom: 15px;
         overflow: hidden;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
         transition: all 0.3s;
      }

      .movie-header {
         display: flex;
         align-items: center;
         padding: 20px 25px;
         cursor: pointer;
         position: relative;
      }

      .movie-header:hover {
         background: rgba(255, 255, 255, 0.05);
      }

      .movie-title-input {
         flex: 1;
         background: #e8e8e8;
         border: 2px solid #333;
         border-radius: 20px;
         padding: 12px 20px;
         font-size: 1rem;
         font-family: inherit;
         font-weight: 500;
         margin-right: 15px;
         pointer-events: none;
         color: #333;
      }

      .movie-author {
         color: white;
         font-size: 0.9rem;
         margin-right: 15px;
         white-space: nowrap;
      }

      .movie-icon {
         width: 35px;
         height: 35px;
         border-radius: 50%;
         background: linear-gradient(135deg, #64b5f6, #2196f3);
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 20px;
      }

      .movie-content {
         max-height: 0;
         overflow: hidden;
         transition: max-height 0.4s ease;
         padding: 0 25px;
      }

      .movie-item.expanded .movie-content {
         max-height: 800px;
         padding: 0 25px 25px 25px;
      }

      .movie-rating {
         background: rgba(255, 215, 79, 0.2);
         padding: 10px;
         border-radius: 10px;
         color: white;
         margin-bottom: 15px;
         text-align: center;
         font-weight: bold;
      }

      .movie-description {
         background: #e8e8e8;
         border: 2px solid #4a3654;
         border-radius: 15px;
         padding: 20px;
         font-size: 0.95rem;
         line-height: 1.6;
         color: #333;
         margin-bottom: 15px;
      }

      .button-actions {
         display: flex;
         gap: 10px;
      }

      .btn-action {
         flex: 1;
         padding: 10px;
         border: none;
         border-radius: 10px;
         font-size: 0.9rem;
         cursor: pointer;
         font-weight: 600;
         transition: all 0.3s;
         text-decoration: none;
         text-align: center;
      }

      .btn-eliminar {
         background: #ff6b6b;
         color: white;
      }

      .btn-eliminar:hover {
         background: #ff4444;
      }

      .no-reviews {
         text-align: center;
         padding: 40px;
         color: #666;
         font-size: 1.1rem;
      }

      .no-reviews a {
         color: #8b6b9e;
         text-decoration: underline;
         display: inline-block;
         margin-top: 10px;
      }
   </style>
</head>
<body>
   <div class="container">
      <div class="header">
         <a href='/' class="logo">Opi</a>
         <a href='/'><img class="cebolla" src="../static/img/cebolla.jpg" alt="Onion Logo"></a>
         <a href='/' class="logo">nion</a>
      </div>
   </div>

   <img class="wave" src="../static/img/ondas.png">

   <!-- Informaci√≥n del perfil -->
   {% if user %}
   <div class="perfil-header">
      <h2>üë§ {{ user }}</h2>
   </div>

   <!-- Botones de acci√≥n -->
   <div class="nav-perfil">
      <a href="/crear_resena?user={{ user }}" class="btn-perfil">
         ‚ûï Crear Nueva Rese√±a
      </a>
   </div>
   {% endif %}

   <!-- Lista de rese√±as -->
   <div class="movies-list">
      {% if rese√±as and rese√±as|length > 0 %}
         <h3 style="text-align: center; color: #8b6b9e; margin-bottom: 20px;">
            üìΩÔ∏è Mis Rese√±as ({{ rese√±as|length }})
         </h3>
         {% for r in rese√±as %}
         <div class="movie-item expanded" onclick="toggleMovie(event)">
            <div class="movie-header">
               <input type="text" class="movie-title-input" value="{{ r[0] }}" readonly>
               <span class="movie-author">{{ user }}</span>
               <span class="movie-icon">üßÖ</span>
            </div>
            <div class="movie-content">
               <div class="movie-rating">‚≠ê {{ r[1] }}/5</div>
               <div class="movie-description">
                  {% if r[2] %}
                     {{ r[2] }}
                  {% else %}
                     <em>Sin comentario</em>
                  {% endif %}
               </div>
               <div class="button-actions">
                  <a href="/eliminar_resena/{{ r[3] }}" class="btn-action btn-eliminar" 
                     onclick="return confirm('¬øEst√°s seguro de que quieres eliminar esta rese√±a?')">
                     üóëÔ∏è Eliminar
                  </a>
               </div>
            </div>
         </div>
         {% endfor %}
      {% else %}
         <div class="no-reviews">
            üòî No tienes rese√±as a√∫n
            {% if user %}
            <br>
            <a href="/crear_resena?user={{ user }}">
            </a>
            {% endif %}
         </div>
      {% endif %}
   </div>

   <a href='/buscar_p' class="volver-button">Volver</a>

   <script>
      function toggleMovie(event) {
         // Solo expandir si no clickean en links o botones
         if (event.target.tagName !== 'A' && !event.target.closest('a')) {
            const movieItem = event.currentTarget;
            movieItem.classList.toggle('expanded');
         }
      }
   </script>
</body>
</html>